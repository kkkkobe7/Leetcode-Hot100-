# 142. 环形链表 2

### 解题思路拆解

**1. 第一阶段：判断有没有环 (和上一题一样)**

- 派出 **慢指针 (slow)** 和 **快指针 (fast)**。
- slow 一次走 1 步，fast 一次走 2 步。
- 如果 fast 走到了尽头 (nullptr)，说明没环，直接返回 null。
- 如果 fast 追上了 slow（相遇），说明有环。**停下来！** 此时我们需要记录下这个**相遇点**。

**2. 第二阶段：寻找入口 (数学推导)**

- 这是一个非常巧妙的数学结论（不想看公式可以直接看结论）：设起点到环入口距离为 `x`。设环入口到相遇点距离为 `y`。设相遇点回到环入口距离为 `z`。**结论：** `x=z`。
- **直观解释：**当快慢指针相遇时，**“起点到环入口的距离”** 恰好等于 **“相遇点继续往前走到环入口的距离”**。
- 证明建议参考[Leetcode Krahets题解](https://leetcode.cn/u/jyd/)

**3. 第三阶段：算法实现**

- 基于上面的结论，我们只需要做两件事：让其中一个指针（比如 fast）回到**链表起点 head**。另一个指针（slow）保持在**相遇点**不动。
- **变速：** 两个人现在**都变成一次走 1 步**。它们同时开始走，一定会在**环的入口**相遇。



简洁版代码：

```c++
class Solution {
public:
    ListNode *detectCycle(ListNode *head) {
        ListNode* slow = head, *fast = head;
        while (fast && fast->next)
        {
            slow = slow->next;
            fast = fast->next->next;
            if (slow == fast) break;
        }
        if (fast == nullptr || fast->next == nullptr) return nullptr;

        fast = head;
        while (slow != fast)
        {
            slow = slow->next;
            fast = fast->next;
        }
        return slow;
    }
};
```

注释版代码：

```c++
class Solution {
public:
    ListNode *detectCycle(ListNode *head) {
        // 1. 初始化快慢指针
        ListNode* slow = head, *fast = head;
        
        // 2. 第一阶段：判断是否有环 (Floyd 判圈算法)
        while (fast && fast->next)
        {
            slow = slow->next;       // 慢指针走一步
            fast = fast->next->next; // 快指针走两步
            
            // 如果相遇，说明有环，跳出循环进入第二阶段
            if (slow == fast) break;
        }

        // 3. 检查循环结束的原因
        // 如果是因为 fast 走到了尽头跳出的循环（而不是 break），说明无环
        if (fast == nullptr || fast->next == nullptr) return nullptr;

        // 4. 第二阶段：寻找入环点 (数学魔法)
        // 将 fast 指针重置回链表头部
        fast = head;
        
        // slow 指针保留在刚才的相遇点
        // 两个指针同时移动，且每次都只走一步
        while (slow != fast)
        {
            slow = slow->next;
            fast = fast->next;
        }
        
        // 5. 再次相遇的点，就是环的入口
        return slow;
    }
};
```

